/*!
 * Avanti Search - v1.0.0 - 2017-08-01
 * https://github.com/avanti/avantisearch
 * Licensed MIT
 */
function goToTopPage(){}!function($){var AvantiSearch={init:function(t,e){var o=this;o.options=$.extend(o.getDefaultOptions(),e),o.options.$result=t,o.start(),o.bind()},start:function(){var t=this;t._createButtons(),t.request=t._setRequest(),t._concatRequest(),t._setPaginationInfo(),t.checkAndStart()},_createButtons:function(){var t=this;$(".resultItemsWrapper div[id^=ResultItems]").before('<button class="'+t.options.classLoadLess+" "+t.options.classLoadBtnHide+'">'+t.options.textLoadLess+"</button>").after('<button class="'+t.options.classLoadMore+'">'+t.options.textLoadMore+"</button>")},checkAndStart:function(){var t=this;t._checkRequestWithCookie()?t.startWithCookie():t.startWithoutCookie(),t.options.$result.trigger("avantisearch.init",[t.options,t.request])},_checkRequestWithCookie:function(){var t=this;if("undefined"==typeof Cookies)throw new Error("You need install this plugin https://github.com/js-cookie/js-cookie");var e=window.location.hash.substr(1),o=Cookies.get(t.options.cookieName);return!isNaN(parseInt(e))&&void 0!==o},startWithCookie:function(){var t=this;t._setParamsFromCookie(),t._applyCookieParams(),t._getTotalItems(function(e){t.options.totalItems=e,t.options.$totalItems.text(e),t.options.totalPages=t._getTotalPages(),t._checkAndLoadWithCookie()})},_checkAndLoadWithCookie:function(){var t=this,e=t.request.query.PageNumber,o=t.options.totalPages;t.options.$result.trigger("avantisearch.initWithCookie",[t.options,t.request]),e===o&&1!==e?(t._showButton(t.options.classLoadLess),t._hideButton(t.options.classLoadMore),t.load("html",e,function(){t._showItems(e),t.load("prepend",e-1)})):1===e?t._startFirst(e,1!==o):e>1&&(t._showButton(t.options.classLoadMore),t._showButton(t.options.classLoadLess),t.load("html",e,function(){t._setUrlHash(e),t._showItems(e),t.load("append",e+1,function(){t.load("prepend",e-1,function(){t.request.query.PageNumber=e,t._concatRequest(),t._saveCookie()})})}))},_startFirst:function(t,e,o){var s=this;void 0===e&&(e=!0),s._hideButton(s.options.classLoadLess),s.load("html",t,function(){s._showItems(t),s._saveCookie(),e?s.load("append",t+1,function(){s._showButton(s.options.classLoadMore),void 0!==o&&o()}):(s._hideButton(s.options.classLoadMore),void 0!==o&&o())})},startWithoutCookie:function(){var t=this;t._checkDefaultParams()&&t._setDefaultParams(),t.options.$result.find("> div > ul > li").attr("page",1).removeClass("last first"),t._setUrlHash(1),t._saveCookie(),t.load("append",2)},load:function(t,e,o){var s=this;s.request.query.PageNumber=e,s._concatRequest(),"function"==typeof o?s._search(t,o):s._search(t)},_search:function(t,e,o){var s=this;s.options.$result.trigger("avantisearch.beforeSearch",[s.options,s.request]),void 0===o&&(o=0),$.ajax({url:s.request.url,type:"GET"}).then(function(a){var r=s.options.$result.find("> div > ul"),i=$(a).find("ul");i.find(".last, .first").removeClass("last first"),i.find(".helperComplement").remove();var n=i.find("li");n.attr("page",s.request.query.PageNumber),n.addClass(s.options.classItemPreLoad),r[t](i.html()),s.options.$result.is(":hidden")&&s.options.$result.show(),s.options.$result.trigger("avantisearch.afterSearch",[s.options,s.request]),o=0,"function"==typeof e&&e(s)},function(a){throw 500===a.status&&o<1&&(o++,s._search(t,e,o)),new Error("Error on get page",a)})},_setParamsFromCookie:function(){var t=this,e=Cookies.get(t.options.cookieName);t.request.query=JSON.parse(e)},_applyCookieParams:function(){var t=this;t._setOrder(),t._setFilters()},_setOrder:function(){var t=this;t.options.$selectOrder.val(t.request.O)},_setFilters:function(t){var e=this,t=e.request.query.fq;for(var o in t){var s=t[o];if("function"==typeof s)return!0;var a=e.options.$filters.find('input[rel="fq='+s+'"]');a.length&&a.attr("checked","checked").parent().addClass(e.options.classFilterActive)}},_checkDefaultParams:function(){var t=this;return!!Object.keys(t.options.defaultParams).length},_setDefaultParams:function(){var t=this;t.request=$.extend(!0,t.request,t.options.defaultParams)},_setUrlHash:function(t){var e=this,o=void 0!==t?t:e.request.query.PageNumber;window.location.hash=o},_showItems:function(t){var e=this;e.options.$result.trigger("avantisearch.beforeShowItems",[e.options,e.request,t]),e.options.$result.find("."+e.options.classItemPreLoad+'[page="'+t+'"]').removeClass(e.options.classItemPreLoad),e.options.$result.trigger("avantisearch.afterShowItems",[e.options,e.request,t])},_enableButton:function(t){$("."+t).removeAttr("disabled")},_disableButton:function(t){$("."+t).attr("disabled","disabled")},_hideButton:function(t){var e=this;$("."+t).addClass(e.options.classLoadBtnHide)},_showButton:function(t){var e=this;$("."+t).removeClass(e.options.classLoadBtnHide)},_getPageByType:function(type){var self=this,$items=self.options.$result.find("> div > ul > li"),method="last",operation="+";"prev"===type&&(method="first",operation="-");var page=Number($items[method]().attr("page"));return{showPage:page,nextPage:eval(page+operation+1)}},_concatRequest:function(){var t=this,e=t.request.query,o=t.request.route+"?",s=Object.keys(e).length-1,a=0;for(var r in e){if("fq"===r){var i=t._concatRequestFilter(e[r],r);o=o.concat(i)}else o=o.concat(r,"=",e[r]);a!==s&&(o=o.concat("&")),a++}t.request.url=o},_concatRequestFilter:function(t,e){for(var o="",s=0,a=t.length;s<a;s++)o=o.concat(e,"=",t[s]),s!==a-1&&(o=o.concat("&"));return o},_saveCookie:function(t){var e=this;void 0===t&&(t=JSON.parse(JSON.stringify(e.request.query)));var o=JSON.stringify(t);Cookies.set(e.options.cookieName,o)},_loadNext:function(t){var e=this;return!(t.nextPage<1||t.nextPage>e.options.totalPages)},_setPaginationInfo:function(){var t=this;t.options.totalItems=t._getTotalItems(),t.options.totalPages=t._getTotalPages()},_loadFirst:function(t){var e=this;e._getTotalItems(function(o){e.options.totalItems=o,e.options.$totalItems.text(o),e.options.totalPages=e._getTotalPages(),e._startFirst(1,1!==e.options.totalPages,t)})},_getTotalItems:function(t){var e=this;if("function"==typeof t){var o=e.request.query.fq,s="/api/catalog_system/pub/products/search?"+e._concatRequestFilter(o,"fq")+"&_from=0&_to=1";return $.ajax({url:s,type:"get"}).then(function(e,o,s){var a=s.getResponseHeader("resources").split("/")[1];return t(a)}),!1}var a=/\D/g,r=e.options.$totalItems.text().replace(a,"");return Math.ceil(r)},_getTotalPages:function(){var t=this,e=t.request.query.PS,o=t.options.totalItems;return Math.ceil(o/e)},_setRequest:function(){var t=this,e=t._getRequestUrl();return t._splitRequestUrl(e)},_getRequestUrl:function(){var t=this.options.$script.html(),e=/\/buscapagina\?.+&PageNumber=/gi.exec(t)[0];return decodeURIComponent(e)},_splitRequestUrl:function(t){var e=t.split("?"),o=e[0];if(e.length>1){var s=e[1].split("#"),a=s[0],r=s[1],i={};return i.fq=[],a.replace(/([^=&]+)=([^&]*)/g,function(t,e,o){var s=decodeURIComponent(o),a=decodeURIComponent(e);"fq"===a?i[a].push(s):i[a]="PageNumber"===a&&""===o?1:s}),{route:o,query:i,hash:r,url:t}}return{route:o,url:t}},bind:function(){var t=this;t.bindLoadMoreAndLess(),t.bindOrder(),t.bindFilters()},bindLoadMoreAndLess:function(){var t=this;$("."+t.options.classLoadLess+", ."+t.options.classLoadMore).on("click",function(e){e.preventDefault();var o="next",s="append",a=t.options.classLoadMore;$(this).hasClass(t.options.classLoadLess)&&(o="prev",s="prepend",a=t.options.classLoadLess);var r=t._getPageByType(o),i=$.extend({},t.request.query);i.PageNumber=r.showPage,t._saveCookie(i),t._loadNext(r)?t.load(s,r.nextPage):t._hideButton(a),t._setUrlHash(r.showPage),t._showItems(r.showPage)})},bindOrder:function(){var t=this;"O"===t.options.$selectOrder.attr("id")&&t.options.$selectOrder.removeAttr("onchange").unbind("change").off("change"),t.options.$selectOrder.on("change",function(e){e.preventDefault();var o=$(this),s=o.val();t.options.$result.trigger("avantisearch.beforeChangeOrder",[t.options,t.request,o]),t._setUrlHash(1),t._changeOrder(s,function(){t.options.$result.trigger("avantisearch.afterChangeOrder",[t.options,t.request,o])})})},_changeOrder:function(t,e){var o=this;o.request.query.O=t,o._concatRequest(),o._setUrlHash(1),o._loadFirst(e)},bindFilters:function(){var t=this;t.options.$filters.on("click",function(e){if("LABEL"===e.target.tagName)return!0;var o=$(this),s=o.find("input"),a=s.is(":checked"),r=s.attr("rel");a?o.addClass(t.options.classFilterActive):o.removeClass(t.options.classFilterActive),t.options.$result.trigger("avantisearch.beforeFilter",[t.options,t.request,o]),t._refreshFilter(r,a,function(){t.options.$result.trigger("avantisearch.afterFilter",[t.options,t.request,o]),t._setUrlHash(1)})})},_refreshFilter:function(t,e,o){var s=this,a=t.split("="),r=a[0],i=a[1];if(e)s.request.query[r].push(i);else{var n=s.request.query[r].indexOf(i);s.request.query[r].splice(n,1)}s._loadFirst(o)},getDefaultOptions:function(){return{$script:$(".resultItemsWrapper").children("script"),$totalItems:$(".searchResultsTime:first .resultado-busca-numero .value"),$selectOrder:$("#O"),$filters:$(".search-multiple-navigator label"),classFilterActive:"filter--active",classItemPreLoad:"shelf-item--preload",classLoadBtnHide:"load-btn--hide",classLoadLess:"load-less",classLoadMore:"load-more",textLoadLess:"Load less",textLoadMore:"Load more",cookieName:"AvantiSearchQuery",defaultParams:{}}}};$.fn.avantiSearch=function(t){var e=this;return window.AvantiSearch=AvantiSearch.init(e,t),e}}(jQuery);