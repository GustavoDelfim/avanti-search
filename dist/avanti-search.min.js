/*!
 * Avanti Search - v1.2.5 - 2017-08-12
 * https://github.com/avanti/avantisearch
 * Licensed MIT
 */
function goToTopPage(){}!function($){window.AvantiSearch={init:function(t,e){var a=this;a.options=$.extend(a.getDefaultOptions(),e),a.options.$result=t,a.start(),a.bind()},start:function(){var t=this;t._createButtons(),t.request=t._setRequest(),t._concatRequest(),t._setPaginationInfo(),t.options.pagination&&t._setPaginationWrap(),t.checkAndStart()},_createButtons:function(){var t=this;$(".resultItemsWrapper div[id^=ResultItems]").before('<button class="'+t.options.classLoadLess+" "+t.options.classLoadBtnHide+'">'+t.options.textLoadLess+"</button>").after('<button class="'+t.options.classLoadMore+'">'+t.options.textLoadMore+"</button>")},_setPaginationWrap:function(){var t=this,e=$("<div />",{class:t.options.classPagination});t.options.$resultItemsWrapper.append(e)},checkAndStart:function(){var t=this;t._checkRequestWithCookie()?t.startWithCookie():t.startWithoutCookie(),t.options.$result.trigger("avantisearch.init",[t.options,t.request])},_checkRequestWithCookie:function(){var t=this;if("undefined"==typeof Cookies)throw new Error("You need install this plugin https://github.com/js-cookie/js-cookie");var e=parseInt(window.location.hash.substr(1)),a=Cookies.get(t.options.cookieName),o=$.extend({},t.request.query);return o.PageNumber=e,!isNaN(e)&&void 0!==a&&JSON.stringify(o)===JSON.stringify(JSON.parse(a))},startWithCookie:function(){var t=this;t._setParamsFromCookie(),t._applyCookieParams(),t._getTotalItems(function(e){t.options.totalItems=parseInt(e),t.options.$totalItems.text(e),t.options.totalPages=t._getTotalPages(),t._checkAndLoadWithCookie()})},_checkAndLoadWithCookie:function(){var t=this,e=t.request.query.PageNumber,a=t.options.totalPages;if(t.options.$result.trigger("avantisearch.initWithCookie",[t.options,t.request]),t.options.pagination)return t._startPagination(),t.load("html",e,function(){t._showItems(e)}),!1;e===a&&1!==e?(t._showButton(t.options.classLoadLess),t._hideButton(t.options.classLoadMore),t.load("html",e,function(){t._showItems(e),t.load("prepend",e-1)})):1===e?t._startFirst(e,1!==a):e>1&&(t._showButton(t.options.classLoadMore),t._showButton(t.options.classLoadLess),t.load("html",e,function(){t._setUrlHash(e),t._showItems(e),t.load("append",e+1,function(){t.load("prepend",e-1,function(){t.request.query.PageNumber=e,t._concatRequest(),t._saveCookie()})})}))},_startFirst:function(t,e,a){var o=this;void 0===e&&(e=!0),!0===o.options.pagination&&(e=!1),o._hideButton(o.options.classLoadLess),o.load("html",t,function(){o._showItems(t),o._saveCookie(),e?o.load("append",t+1,function(){o._showButton(o.options.classLoadMore),void 0!==a&&a()}):(o._hideButton(o.options.classLoadMore),void 0!==a&&a())})},startWithoutCookie:function(){var t=this;if(t._checkDefaultParams()&&t._setDefaultParams(),t.options.$result.find("> div > ul > li").attr("page",1).removeClass("last first"),t._setUrlHash(1),t._saveCookie(),t.options.pagination)return t._startPagination(),!1;t.load("append",2)},_startPagination:function(){var t=this;t._hideButton(t.options.classLoadMore),t._disableButton(t.options.classLoadMore),t._hideButton(t.options.classLoadLess),t._disableButton(t.options.classLoadLess),t._createPagination(),t.bindPagination()},_clearPagination:function(){this.options.$pagination.html("")},load:function(t,e,a){var o=this;o.request.query.PageNumber=e,o._concatRequest(),"function"==typeof a?o._search(t,a):o._search(t)},_search:function(t,e,a){var o=this;o.options.$result.trigger("avantisearch.beforeSearch",[o.options,o.request]),void 0===a&&(a=0),$.ajax({url:o.request.url,type:"GET"}).then(function(n){var s=o.options.$result.find("> div > ul"),i=$(n).find("ul");i.find(".last, .first").removeClass("last first"),i.find(".helperComplement").remove();var r=i.find("li");r.attr("page",o.request.query.PageNumber),o.request.query.PageNumber>1&&r.addClass(o.options.classItemPreLoad),s[t](i.html()),o.options.$result.is(":hidden")&&o.options.$result.show(),o.options.$result.trigger("avantisearch.afterSearch",[o.options,o.request]),a=0,"function"==typeof e&&e(o)},function(n){throw 500===n.status&&a<o.options.attempts&&(a++,o._search(t,e,a)),new Error("Error on get page",n)})},_setParamsFromCookie:function(){var t=this,e=Cookies.get(t.options.cookieName);t.request.query=JSON.parse(e)},_applyCookieParams:function(){var t=this;t._setOrder(),t._setFilters()},_setOrder:function(){var t=this;t.options.$selectOrder.val(t.request.O)},_setFilters:function(t){var e=this,t=e.request.query.fq;for(var a in t){var o=t[a];if("function"==typeof o)return!0;var n=e.options.$filters.find('input[rel="fq='+o+'"]');n.length&&n.attr("checked","checked").parent().addClass(e.options.classFilterActive)}},_checkDefaultParams:function(){var t=this;return!!Object.keys(t.options.defaultParams).length},_setDefaultParams:function(){var t=this;t.request=$.extend(!0,t.request,t.options.defaultParams)},_setUrlHash:function(t){var e=this,a=void 0!==t?t:e.request.query.PageNumber;window.location.hash=a},_showItems:function(t){var e=this;e.options.$result.trigger("avantisearch.beforeShowItems",[e.options,e.request,t]),e.options.$result.find("."+e.options.classItemPreLoad+'[page="'+t+'"]').removeClass(e.options.classItemPreLoad),e.options.$result.trigger("avantisearch.afterShowItems",[e.options,e.request,t])},_enableButton:function(t){$("."+t).removeAttr("disabled")},_disableButton:function(t){$("."+t).attr("disabled","disabled")},_hideButton:function(t){var e=this;$("."+t).addClass(e.options.classLoadBtnHide)},_showButton:function(t){var e=this;$("."+t).removeClass(e.options.classLoadBtnHide)},_getPageByType:function(type){var self=this,$items=self.options.$result.find("> div > ul > li"),method="last",operation="+";"prev"===type&&(method="first",operation="-");var page=Number($items[method]().attr("page"));return{showPage:page,nextPage:eval(page+operation+1)}},_concatRequest:function(){var t=this,e=t.request.query,a=t.request.route+"?",o=Object.keys(e).length-1,n=0;for(var s in e){if("fq"===s){var i=t._concatRequestFilter(e[s],s);a=a.concat(i)}else a=a.concat(s,"=",e[s]);n!==o&&(a=a.concat("&")),n++}t.request.url=a},_concatRequestFilter:function(t,e){for(var a="",o=0,n=t.length;o<n;o++)a=a.concat(e,"=",t[o]),o!==n-1&&(a=a.concat("&"));return a},_saveCookie:function(t){var e=this;void 0===t&&(t=JSON.parse(JSON.stringify(e.request.query)));var a=JSON.stringify(t);Cookies.set(e.options.cookieName,a)},_loadNext:function(t){var e=this;return!(t.nextPage<1||t.nextPage>e.options.totalPages)},_setPaginationInfo:function(){var t=this;t.options.totalItems=t._getTotalItems(),t.options.totalPages=t._getTotalPages()},_loadFirst:function(t){var e=this;e._getTotalItems(function(a){e.options.totalItems=parseInt(a),e.options.$totalItems.text(a),e.options.totalPages=e._getTotalPages(),e._startFirst(1,1!==e.options.totalPages,t)})},_getTotalItems:function(t){var e=this;if("function"==typeof t){e._concatRequest();var a="/api/catalog_system/pub/products/search"+e.request.url.replace("/buscapagina","")+"&_from=0&_to=1";return $.ajax({url:a,type:"get"}).then(function(e,a,o){var n=o.getResponseHeader("resources"),s=parseInt(n.split("/")[1]);return t(s)}),!1}var o=/\D/g,n=e.options.$totalItems.text().replace(o,"");return parseInt(Math.ceil(n))},_getTotalPages:function(){var t=this,e=t.request.query.PS,a=t.options.totalItems;return Math.ceil(a/e)},_createPagination:function(){var t=this;t.options.$pagination=$("."+t.options.classPagination),t._createPaginationFirstButton(),t._createPaginationPrevButton(),t._createPaginationButtons(),t._createPaginationNextButton(),t._createPaginationLastButton()},_createPaginationFirstButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--first",page:"1"}).text(t.options.textPaginationFirst);t.options.$pagination.append(e),1===t.request.query.PageNumber&&t._disablePaginationButton(e)},_createPaginationPrevButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--prev",page:t.request.query.PageNumber-1}).text(t.options.textPaginationPrev);t.options.$pagination.append(e),1===t.request.query.PageNumber&&t._disablePaginationButton(e)},_createPaginationButtons:function(){for(var t=this,e=t.request.query.PageNumber-t.options.paginationRangeButtons;e<=t.request.query.PageNumber;e++)if(!(e<1||e===t.request.query.PageNumber)){a=$("<button />",{class:"pagination__button pagination__button--page",page:e}).text(e);t.options.$pagination.append(a)}a=$("<button />",{class:"pagination__button pagination__button--page pagination__button--disabled pagination__button--current",page:t.request.query.PageNumber,disabled:"disabled"}).text(t.request.query.PageNumber);t.options.$pagination.append(a);for(e=t.request.query.PageNumber+1;e<=t.request.query.PageNumber+t.options.paginationRangeButtons;e++)if(!(e>t._getTotalPages())){var a=$("<button />",{class:"pagination__button pagination__button--page",page:e}).text(e);t.options.$pagination.append(a)}},_createPaginationNextButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--next",page:t.request.query.PageNumber+1}).text(t.options.textPaginationNext);t.options.$pagination.append(e),t.request.query.PageNumber===t._getTotalPages()&&t._disablePaginationButton(e)},_createPaginationLastButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--last",page:t._getTotalPages()}).text(t.options.textPaginationLast);t.options.$pagination.append(e),t.request.query.PageNumber===t._getTotalPages()&&t._disablePaginationButton(e)},_disablePaginationButton:function(t){t.addClass("pagination__button--disabled").attr("disabled","disabled")},_setRequest:function(){var t=this,e=t._getRequestUrl();return t._splitRequestUrl(e)},_getRequestUrl:function(){var t=this.options.$script.html(),e=/\/buscapagina\?.+&PageNumber=/gi.exec(t)[0];return decodeURIComponent(e)},_splitRequestUrl:function(t){var e=t.split("?"),a=e[0];if(e.length>1){var o=e[1].split("#"),n=o[0],s=o[1],i={};return i.fq=[],n.replace(/([^=&]+)=([^&]*)/g,function(t,e,a){var o=decodeURIComponent(a),n=decodeURIComponent(e);"fq"===n?i[n].push(o):i[n]="PageNumber"===n&&""===a?1:o}),{route:a,query:i,hash:s,url:t}}return{route:a,url:t}},bind:function(){var t=this;t.bindLoadMoreAndLess(),t.bindOrder(),t.bindFilters()},bindLoadMoreAndLess:function(){var t=this;$("."+t.options.classLoadLess+", ."+t.options.classLoadMore).on("click",function(e){e.preventDefault();var a="next",o="append",n=t.options.classLoadMore;$(this).hasClass(t.options.classLoadLess)&&(a="prev",o="prepend",n=t.options.classLoadLess);var s=t._getPageByType(a),i=$.extend({},t.request.query);i.PageNumber=s.showPage,t._saveCookie(i),t._loadNext(s)?t.load(o,s.nextPage):t._hideButton(n),t._setUrlHash(s.showPage),t._showItems(s.showPage)})},bindOrder:function(){var t=this;"O"===t.options.$selectOrder.attr("id")&&t.options.$selectOrder.removeAttr("onchange").unbind("change").off("change"),t.options.$selectOrder.on("change",function(e){e.preventDefault();var a=$(this),o=a.val();t.options.$result.trigger("avantisearch.beforeChangeOrder",[t.options,t.request,a]),t._setUrlHash(1),t._changeOrder(o,function(){t.options.$result.trigger("avantisearch.afterChangeOrder",[t.options,t.request,a])})})},_changeOrder:function(t,e){var a=this;a.request.query.O=t,a._concatRequest(),a._setUrlHash(1),a._loadFirst(e)},bindFilters:function(){var t=this;t.options.$filters.on("click",function(e){if("LABEL"===e.target.tagName)return!0;var a=$(this),o=a.find("input"),n=o.is(":checked"),s=o.attr("rel");n?a.addClass(t.options.classFilterActive):a.removeClass(t.options.classFilterActive),t.options.$result.trigger("avantisearch.beforeFilter",[t.options,t.request,a]),t._refreshFilter(s,n,function(){t.options.$result.trigger("avantisearch.afterFilter",[t.options,t.request,a]),t._setUrlHash(1),t._clearPagination(),t._createPagination(),t.bindPagination()})})},_refreshFilter:function(t,e,a){var o=this,n=t.split("="),s=n[0],i=n[1];if(e)o.request.query[s].push(i);else{var r=o.request.query[s].indexOf(i);o.request.query[s].splice(r,1)}o._loadFirst(a)},bindPagination:function(){var t=this;$("."+t.options.classPagination).find("button").on("click",function(e){e.preventDefault();var a=$(this),o=parseInt(a.attr("page"));t.options.$result.trigger("avantisearch.beforeChangePage",[t.options,t.request]),t.load("html",o,function(){t._setUrlHash(o),t._showItems(o),t.request.query.PageNumber=o,t._clearPagination(),t._startPagination(),t._concatRequest(),t._saveCookie(),t.options.$result.trigger("avantisearch.afterChangePage",[t.options,t.request])})})},getDefaultOptions:function(){return{$resultItemsWrapper:$(".resultItemsWrapper"),$script:$(".resultItemsWrapper").children("script"),$totalItems:$(".searchResultsTime:first .resultado-busca-numero .value"),$selectOrder:$("#O"),$filters:$(".search-multiple-navigator label"),classFilterActive:"filter--active",classItemPreLoad:"shelf-item--preload",classLoadBtnHide:"load-btn--hide",classLoadLess:"load-less",classLoadMore:"load-more",classPagination:"pagination",textLoadLess:"Load less",textLoadMore:"Load more",textPaginationFirst:"First",textPaginationPrev:"Prev",textPaginationNext:"Next",textPaginationLast:"Last",pagination:!1,paginationRangeButtons:3,cookieName:"AvantiSearchQuery",defaultParams:{},attempts:1}}},$.fn.avantiSearch=function(t){var e=this;return AvantiSearch.init(e,t),e}}(jQuery);