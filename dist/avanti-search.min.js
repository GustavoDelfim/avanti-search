/*!
 * Avanti Search - v1.1.1 - 2017-08-04
 * https://github.com/avanti/avantisearch
 * Licensed MIT
 */
function goToTopPage(){}!function($){var AvantiSearch={init:function(t,e){var s=this;s.options=$.extend(s.getDefaultOptions(),e),s.options.$result=t,s.start(),s.bind()},start:function(){var t=this;t._createButtons(),t.request=t._setRequest(),t._concatRequest(),t._setPaginationInfo(),t.checkAndStart()},_createButtons:function(){var t=this;$(".resultItemsWrapper div[id^=ResultItems]").before('<button class="'+t.options.classLoadLess+" "+t.options.classLoadBtnHide+'">'+t.options.textLoadLess+"</button>").after('<button class="'+t.options.classLoadMore+'">'+t.options.textLoadMore+"</button>")},checkAndStart:function(){var t=this;t._checkRequestWithCookie()?t.startWithCookie():t.startWithoutCookie(),t.options.$result.trigger("avantisearch.init",[t.options,t.request])},_checkRequestWithCookie:function(){var t=this;if("undefined"==typeof Cookies)throw new Error("You need install this plugin https://github.com/js-cookie/js-cookie");var e=window.location.hash.substr(1),s=Cookies.get(t.options.cookieName);return!isNaN(parseInt(e))&&void 0!==s},startWithCookie:function(){var t=this;t._setParamsFromCookie(),t._applyCookieParams(),t._getTotalItems(function(e){t.options.totalItems=e,t.options.$totalItems.text(e),t.options.totalPages=t._getTotalPages(),t._checkAndLoadWithCookie()})},_checkAndLoadWithCookie:function(){var t=this,e=t.request.query.PageNumber,s=t.options.totalPages;t.options.$result.trigger("avantisearch.initWithCookie",[t.options,t.request]),e===s&&1!==e?(t._showButton(t.options.classLoadLess),t._hideButton(t.options.classLoadMore),t.load("html",e,function(){t._showItems(e),t.load("prepend",e-1)})):1===e?t._startFirst(e,1!==s):e>1&&(t._showButton(t.options.classLoadMore),t._showButton(t.options.classLoadLess),t.load("html",e,function(){t._setUrlHash(e),t._showItems(e),t.load("append",e+1,function(){t.load("prepend",e-1,function(){t.request.query.PageNumber=e,t._concatRequest(),t._saveCookie()})})}))},_startFirst:function(t,e,s){var o=this;void 0===e&&(e=!0),o._hideButton(o.options.classLoadLess),o.load("html",t,function(){o._showItems(t),o._saveCookie(),e?o.load("append",t+1,function(){o._showButton(o.options.classLoadMore),void 0!==s&&s()}):(o._hideButton(o.options.classLoadMore),void 0!==s&&s())})},startWithoutCookie:function(){var t=this;t._checkDefaultParams()&&t._setDefaultParams(),t.options.$result.find("> div > ul > li").attr("page",1).removeClass("last first"),t._setUrlHash(1),t._saveCookie(),t.load("append",2)},load:function(t,e,s){var o=this;o.request.query.PageNumber=e,o._concatRequest(),"function"==typeof s?o._search(t,s):o._search(t)},_search:function(t,e,s){var o=this;o.options.$result.trigger("avantisearch.beforeSearch",[o.options,o.request]),void 0===s&&(s=0),$.ajax({url:o.request.url,type:"GET"}).then(function(a){var r=o.options.$result.find("> div > ul"),i=$(a).find("ul");i.find(".last, .first").removeClass("last first"),i.find(".helperComplement").remove();var n=i.find("li");n.attr("page",o.request.query.PageNumber),o.request.query.PageNumber>1&&n.addClass(o.options.classItemPreLoad),r[t](i.html()),o.options.$result.is(":hidden")&&o.options.$result.show(),o.options.$result.trigger("avantisearch.afterSearch",[o.options,o.request]),s=0,"function"==typeof e&&e(o)},function(a){throw 500===a.status&&s<1&&(s++,o._search(t,e,s)),new Error("Error on get page",a)})},_setParamsFromCookie:function(){var t=this,e=Cookies.get(t.options.cookieName);t.request.query=JSON.parse(e)},_applyCookieParams:function(){var t=this;t._setOrder(),t._setFilters()},_setOrder:function(){var t=this;t.options.$selectOrder.val(t.request.O)},_setFilters:function(t){var e=this,t=e.request.query.fq;for(var s in t){var o=t[s];if("function"==typeof o)return!0;var a=e.options.$filters.find('input[rel="fq='+o+'"]');a.length&&a.attr("checked","checked").parent().addClass(e.options.classFilterActive)}},_checkDefaultParams:function(){var t=this;return!!Object.keys(t.options.defaultParams).length},_setDefaultParams:function(){var t=this;t.request=$.extend(!0,t.request,t.options.defaultParams)},_setUrlHash:function(t){var e=this,s=void 0!==t?t:e.request.query.PageNumber;window.location.hash=s},_showItems:function(t){var e=this;e.options.$result.trigger("avantisearch.beforeShowItems",[e.options,e.request,t]),e.options.$result.find("."+e.options.classItemPreLoad+'[page="'+t+'"]').removeClass(e.options.classItemPreLoad),e.options.$result.trigger("avantisearch.afterShowItems",[e.options,e.request,t])},_enableButton:function(t){$("."+t).removeAttr("disabled")},_disableButton:function(t){$("."+t).attr("disabled","disabled")},_hideButton:function(t){var e=this;$("."+t).addClass(e.options.classLoadBtnHide)},_showButton:function(t){var e=this;$("."+t).removeClass(e.options.classLoadBtnHide)},_getPageByType:function(type){var self=this,$items=self.options.$result.find("> div > ul > li"),method="last",operation="+";"prev"===type&&(method="first",operation="-");var page=Number($items[method]().attr("page"));return{showPage:page,nextPage:eval(page+operation+1)}},_concatRequest:function(){var t=this,e=t.request.query,s=t.request.route+"?",o=Object.keys(e).length-1,a=0;for(var r in e){if("fq"===r){var i=t._concatRequestFilter(e[r],r);s=s.concat(i)}else s=s.concat(r,"=",e[r]);a!==o&&(s=s.concat("&")),a++}t.request.url=s},_concatRequestFilter:function(t,e){for(var s="",o=0,a=t.length;o<a;o++)s=s.concat(e,"=",t[o]),o!==a-1&&(s=s.concat("&"));return s},_saveCookie:function(t){var e=this;void 0===t&&(t=JSON.parse(JSON.stringify(e.request.query)));var s=JSON.stringify(t);Cookies.set(e.options.cookieName,s)},_loadNext:function(t){var e=this;return!(t.nextPage<1||t.nextPage>e.options.totalPages)},_setPaginationInfo:function(){var t=this;t.options.totalItems=t._getTotalItems(),t.options.totalPages=t._getTotalPages()},_loadFirst:function(t){var e=this;e._getTotalItems(function(s){e.options.totalItems=s,e.options.$totalItems.text(s),e.options.totalPages=e._getTotalPages(),e._startFirst(1,1!==e.options.totalPages,t)})},_getTotalItems:function(t){var e=this;if("function"==typeof t){var s=e.request.query.fq,o="/api/catalog_system/pub/products/search?"+e._concatRequestFilter(s,"fq")+"&_from=0&_to=1";return $.ajax({url:o,type:"get"}).then(function(e,s,o){var a=o.getResponseHeader("resources").split("/")[1];return t(a)}),!1}var a=/\D/g,r=e.options.$totalItems.text().replace(a,"");return Math.ceil(r)},_getTotalPages:function(){var t=this,e=t.request.query.PS,s=t.options.totalItems;return Math.ceil(s/e)},_setRequest:function(){var t=this,e=t._getRequestUrl();return t._splitRequestUrl(e)},_getRequestUrl:function(){var t=this.options.$script.html(),e=/\/buscapagina\?.+&PageNumber=/gi.exec(t)[0];return decodeURIComponent(e)},_splitRequestUrl:function(t){var e=t.split("?"),s=e[0];if(e.length>1){var o=e[1].split("#"),a=o[0],r=o[1],i={};return i.fq=[],a.replace(/([^=&]+)=([^&]*)/g,function(t,e,s){var o=decodeURIComponent(s),a=decodeURIComponent(e);"fq"===a?i[a].push(o):i[a]="PageNumber"===a&&""===s?1:o}),{route:s,query:i,hash:r,url:t}}return{route:s,url:t}},bind:function(){var t=this;t.bindLoadMoreAndLess(),t.bindOrder(),t.bindFilters()},bindLoadMoreAndLess:function(){var t=this;$("."+t.options.classLoadLess+", ."+t.options.classLoadMore).on("click",function(e){e.preventDefault();var s="next",o="append",a=t.options.classLoadMore;$(this).hasClass(t.options.classLoadLess)&&(s="prev",o="prepend",a=t.options.classLoadLess);var r=t._getPageByType(s),i=$.extend({},t.request.query);i.PageNumber=r.showPage,t._saveCookie(i),t._loadNext(r)?t.load(o,r.nextPage):t._hideButton(a),t._setUrlHash(r.showPage),t._showItems(r.showPage)})},bindOrder:function(){var t=this;"O"===t.options.$selectOrder.attr("id")&&t.options.$selectOrder.removeAttr("onchange").unbind("change").off("change"),t.options.$selectOrder.on("change",function(e){e.preventDefault();var s=$(this),o=s.val();t.options.$result.trigger("avantisearch.beforeChangeOrder",[t.options,t.request,s]),t._setUrlHash(1),t._changeOrder(o,function(){t.options.$result.trigger("avantisearch.afterChangeOrder",[t.options,t.request,s])})})},_changeOrder:function(t,e){var s=this;s.request.query.O=t,s._concatRequest(),s._setUrlHash(1),s._loadFirst(e)},bindFilters:function(){var t=this;t.options.$filters.on("click",function(e){if("LABEL"===e.target.tagName)return!0;var s=$(this),o=s.find("input"),a=o.is(":checked"),r=o.attr("rel");a?s.addClass(t.options.classFilterActive):s.removeClass(t.options.classFilterActive),t.options.$result.trigger("avantisearch.beforeFilter",[t.options,t.request,s]),t._refreshFilter(r,a,function(){t.options.$result.trigger("avantisearch.afterFilter",[t.options,t.request,s]),t._setUrlHash(1)})})},_refreshFilter:function(t,e,s){var o=this,a=t.split("="),r=a[0],i=a[1];if(e)o.request.query[r].push(i);else{var n=o.request.query[r].indexOf(i);o.request.query[r].splice(n,1)}o._loadFirst(s)},getDefaultOptions:function(){return{$script:$(".resultItemsWrapper").children("script"),$totalItems:$(".searchResultsTime:first .resultado-busca-numero .value"),$selectOrder:$("#O"),$filters:$(".search-multiple-navigator label"),classFilterActive:"filter--active",classItemPreLoad:"shelf-item--preload",classLoadBtnHide:"load-btn--hide",classLoadLess:"load-less",classLoadMore:"load-more",textLoadLess:"Load less",textLoadMore:"Load more",cookieName:"AvantiSearchQuery",defaultParams:{}}}};$.fn.avantiSearch=function(t){var e=this;return window.AvantiSearch=AvantiSearch.init(e,t),e}}(jQuery);